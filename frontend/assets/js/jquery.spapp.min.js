!function($){$.spapp=function(options){var config,routes={};config=$.extend({defaultView:$("main#spapp > section:last-child").attr("id"),templateDir:"./tpl/",pageNotFound:!1},options),$("main#spapp > section").each(function(k,e){var elm=$(this);routes[elm.attr("id")]={view:elm.attr("id"),load:elm.data("load"),onCreate:function(){},onReady:function(){}}}),this.route=function(options){$.extend(routes[options.view],options)};var routeChange=function(){var id=location.hash.slice(1),route=routes[id],elm=$("#"+id);elm&&route?elm.hasClass("spapp-created")?route.onReady():(elm.addClass("spapp-created"),route.load?elm.load(config.templateDir+route.load,function(){route.onCreate(),route.onReady()}):(route.onCreate(),route.onReady())):config.pageNotFound?window.location.hash=config.pageNotFound:console.log(id+" not defined")};return this.run=function(){window.addEventListener("hashchange",function(){routeChange()}),window.location.hash?routeChange():window.location.hash=config.defaultView},this}}(jQuery);
